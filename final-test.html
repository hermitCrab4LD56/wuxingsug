<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æœ€ç»ˆæµ‹è¯• - Homeé¡µé¢ç™½å±ä¿®å¤éªŒè¯</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background: #f5f5f5;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .step {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .button {
            background: #1890ff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        .result {
            margin-top: 10px;
            padding: 10px;
            border-radius: 4px;
            background: #f0f0f0;
            font-family: monospace;
            white-space: pre-wrap;
            max-height: 300px;
            overflow-y: auto;
        }
        .success { background: #f6ffed; color: #52c41a; }
        .error { background: #fff2f0; color: #ff4d4f; }
        .warning { background: #fffbe6; color: #faad14; }
        .info { background: #e6f7ff; color: #1890ff; }
        .highlight {
            background: #fff2e8;
            padding: 10px;
            border-left: 4px solid #fa8c16;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ¯ æœ€ç»ˆæµ‹è¯• - Homeé¡µé¢ç™½å±ä¿®å¤éªŒè¯</h1>
        
        <div class="highlight">
            <strong>ä¿®å¤å†…å®¹:</strong> å·²ä¿®å¤å…«å­—APIæ•°æ®ç»“æ„ä¸åŒ¹é…é—®é¢˜ï¼Œå°†{year, month, day, hour}æ ¼å¼æ”¹ä¸º{year_pillar, month_pillar, day_pillar, hour_pillar}æ ¼å¼ã€‚
        </div>
        
        <div class="step">
            <h3>æ­¥éª¤1: å®Œæ•´æµ‹è¯•æµç¨‹</h3>
            <button class="button" onclick="runCompleteTest()">ğŸš€ è¿è¡Œå®Œæ•´æµ‹è¯•</button>
            <div id="testResult" class="result"></div>
        </div>
        
        <div class="step">
            <h3>æ­¥éª¤2: è®¿é—®Homeé¡µé¢</h3>
            <p>åœ¨å®Œæˆæµ‹è¯•åï¼Œç‚¹å‡»ä¸‹é¢çš„é“¾æ¥è®¿é—®Homeé¡µé¢:</p>
            <a href="http://localhost:5173/home" target="_blank" class="button">ğŸ  æ‰“å¼€Homeé¡µé¢</a>
            <div class="info result">å¦‚æœä¿®å¤æˆåŠŸï¼Œåº”è¯¥èƒ½çœ‹åˆ°å®Œæ•´çš„Homeé¡µé¢å†…å®¹ï¼ŒåŒ…æ‹¬ç”¨æˆ·æ¬¢è¿åŒºåŸŸã€å…«å­—ä¿¡æ¯å¡ç‰‡å’Œä»Šæ—¥å»ºè®®</div>
        </div>
        
        <div class="step">
            <h3>æ­¥éª¤3: éªŒè¯é¡µé¢å†…å®¹</h3>
            <div class="info result">æ­£å¸¸çš„Homeé¡µé¢åº”è¯¥åŒ…å«:
âœ… ç”¨æˆ·æ¬¢è¿ä¿¡æ¯ï¼ˆæ˜¾ç¤º"å¼ ä¸‰ä¸°"ï¼‰
âœ… å…«å­—ä¿¡æ¯å¡ç‰‡ï¼ˆæ˜¾ç¤ºå››æŸ±ä¿¡æ¯ï¼‰
âœ… äº”è¡Œåˆ†æå›¾è¡¨
âœ… ä»Šæ—¥å»ºè®®å¡ç‰‡
âœ… å¿«é€Ÿæ“ä½œæŒ‰é’®

å¦‚æœä»ç„¶æ˜¾ç¤ºç™½å±æˆ–å¼•å¯¼é¡µé¢ï¼Œè¯´æ˜è¿˜æœ‰å…¶ä»–é—®é¢˜éœ€è¦è§£å†³ã€‚</div>
        </div>
    </div>

    <script>
        const API_BASE = 'http://localhost:3001';
        
        function log(elementId, message, type = 'info') {
            const element = document.getElementById(elementId);
            const timestamp = new Date().toLocaleTimeString();
            element.className = `result ${type}`;
            element.textContent = `[${timestamp}] ${message}`;
            console.log(`[${timestamp}] ${message}`);
        }
        
        async function runCompleteTest() {
            try {
                log('testResult', 'ğŸš€ å¼€å§‹å®Œæ•´æµ‹è¯•æµç¨‹...', 'warning');
                
                // 1. æ¸…ç†ç¯å¢ƒ
                localStorage.clear();
                
                // 2. ç™»å½•å¼ ä¸‰ä¸°
                const loginResponse = await fetch(`${API_BASE}/auth/login`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        phone: '13800138000',
                        password: '123456'
                    })
                });
                
                if (!loginResponse.ok) {
                    throw new Error(`ç™»å½•å¤±è´¥: HTTP ${loginResponse.status}`);
                }
                
                const loginData = await loginResponse.json();
                if (!loginData.success) {
                    throw new Error(`ç™»å½•å¤±è´¥: ${loginData.message}`);
                }
                
                const user = loginData.data.user;
                const token = loginData.data.token;
                
                let testLog = `âœ… æ­¥éª¤1: ç™»å½•æˆåŠŸ\n`;
                testLog += `   ç”¨æˆ·: ${user.name}\n`;
                testLog += `   å‡ºç”Ÿæ—¥æœŸ: ${user.birth_date}\n`;
                testLog += `   å‡ºç”Ÿæ—¶é—´: ${user.birth_time}\n\n`;
                
                // 3. è·å–å…«å­—ä¿¡æ¯
                const baziResponse = await fetch(`${API_BASE}/bazi/info`, {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });
                
                if (!baziResponse.ok) {
                    throw new Error(`å…«å­—APIå¤±è´¥: HTTP ${baziResponse.status}`);
                }
                
                const baziData = await baziResponse.json();
                if (!baziData.success) {
                    throw new Error(`å…«å­—APIå¤±è´¥: ${baziData.message}`);
                }
                
                const baziInfo = baziData.data;
                testLog += `âœ… æ­¥éª¤2: å…«å­—ä¿¡æ¯è·å–æˆåŠŸ\n`;
                testLog += `   å¹´æŸ±: ${baziInfo.year_pillar}\n`;
                testLog += `   æœˆæŸ±: ${baziInfo.month_pillar}\n`;
                testLog += `   æ—¥æŸ±: ${baziInfo.day_pillar}\n`;
                testLog += `   æ—¶æŸ±: ${baziInfo.hour_pillar}\n`;
                testLog += `   ä¸»è¦äº”è¡Œ: ${baziInfo.primary_element}\n\n`;
                
                // 4. ä¿å­˜çŠ¶æ€åˆ°localStorage
                const storeData = {
                    state: {
                        user: user,
                        isAuthenticated: true,
                        baziInfo: baziInfo,
                        dailyAdvice: null,
                        showWelcomeModal: false
                    },
                    version: 0
                };
                localStorage.setItem('wuxing-app-storage', JSON.stringify(storeData));
                localStorage.setItem('token', token);
                
                testLog += `âœ… æ­¥éª¤3: ç”¨æˆ·çŠ¶æ€ä¿å­˜æˆåŠŸ\n\n`;
                
                // 5. æ¨¡æ‹ŸHomeç»„ä»¶é€»è¾‘
                testLog += `ğŸ  Homeç»„ä»¶æ¸²æŸ“é€»è¾‘éªŒè¯:\n`;
                testLog += `   - ç”¨æˆ·å·²ç™»å½•: âœ…\n`;
                testLog += `   - å…«å­—ä¿¡æ¯å­˜åœ¨: âœ…\n`;
                testLog += `   - åº”è¯¥æ¸²æŸ“: å®Œæ•´Homeé¡µé¢å†…å®¹\n\n`;
                
                testLog += `ğŸ¯ æµ‹è¯•ç»“è®º:\n`;
                testLog += `âœ… æ‰€æœ‰APIè°ƒç”¨æ­£å¸¸\n`;
                testLog += `âœ… æ•°æ®ç»“æ„åŒ¹é…\n`;
                testLog += `âœ… ç”¨æˆ·çŠ¶æ€å®Œæ•´\n`;
                testLog += `âœ… Homeé¡µé¢åº”è¯¥æ­£å¸¸æ˜¾ç¤º\n\n`;
                testLog += `è¯·ç‚¹å‡»ä¸Šæ–¹çš„"æ‰“å¼€Homeé¡µé¢"æŒ‰é’®éªŒè¯ä¿®å¤æ•ˆæœï¼`;
                
                log('testResult', testLog, 'success');
                
            } catch (error) {
                console.error('æµ‹è¯•å¤±è´¥:', error);
                log('testResult', `âŒ æµ‹è¯•å¤±è´¥: ${error.message}\n\nè¯·æ£€æŸ¥æœåŠ¡å™¨æ˜¯å¦æ­£å¸¸è¿è¡Œ`, 'error');
            }
        }
        
        // é¡µé¢åŠ è½½æ—¶æ˜¾ç¤ºè¯´æ˜
        window.onload = function() {
            console.log('ğŸ¯ æœ€ç»ˆæµ‹è¯•å·¥å…·å·²åŠ è½½');
            console.log('å‡†å¤‡éªŒè¯Homeé¡µé¢ç™½å±ä¿®å¤æ•ˆæœ');
        };
    </script>
</body>
</html>